From 280795e35e0261a3c9ebd14178f7b12a00c15226 Mon Sep 17 00:00:00 2001
From: X512 <danger_mail@list.ru>
Date: Tue, 22 Jun 2021 01:47:09 +0900
Subject: ati.accelerant: 64 bit fixes

Change-Id: I0f82dfe7bc73122546d262ab7e94010f1adff500
---
 src/add-ons/accelerants/ati/mach64_overlay.cpp  | 4 ++--
 src/add-ons/accelerants/ati/overlay.cpp         | 4 ++--
 src/add-ons/accelerants/ati/rage128_overlay.cpp | 2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/add-ons/accelerants/ati/mach64_overlay.cpp b/src/add-ons/accelerants/ati/mach64_overlay.cpp
index dedbaacf01..b9a856ae83 100644
--- a/src/add-ons/accelerants/ati/mach64_overlay.cpp
+++ b/src/add-ons/accelerants/ati/mach64_overlay.cpp
@@ -122,8 +122,8 @@ Mach64_DisplayOverlay(const overlay_window* window,
 	OUTREG(VIDEO_FORMAT, videoFormat);
 
 	// Compute offset of overlay buffer in the video memory.
-	uint32 offset = uint32(buffer->buffer) - si.videoMemAddr;
-	
+	uint32 offset = (uint32)((addr_t)buffer->buffer - si.videoMemAddr);
+
 	if (si.chipType < MACH64_264VTB) {
 		OUTREG(BUF0_OFFSET, offset);
 		OUTREG(BUF0_PITCH, buffer->width);
diff --git a/src/add-ons/accelerants/ati/overlay.cpp b/src/add-ons/accelerants/ati/overlay.cpp
index 4d45e1d6e3..6094d03fd1 100644
--- a/src/add-ons/accelerants/ati/overlay.cpp
+++ b/src/add-ons/accelerants/ati/overlay.cpp
@@ -264,7 +264,7 @@ ReleaseOverlay(overlay_token overlayToken)
 {
 	SharedInfo& si = *gInfo.sharedInfo;
 
-	if (overlayToken != (overlay_token)si.overlayToken) {
+	if (overlayToken != (overlay_token)(addr_t)si.overlayToken) {
 		TRACE("ReleaseOverlay() error - no overlay previously allocated\n");
 		return B_BAD_VALUE;
 	}
@@ -285,7 +285,7 @@ ConfigureOverlay(overlay_token overlayToken, const overlay_buffer* buffer,
 {
 	SharedInfo& si = *gInfo.sharedInfo;
 
-	if (overlayToken != (overlay_token)si.overlayToken)
+	if (overlayToken != (overlay_token)(addr_t)si.overlayToken)
 		return B_BAD_VALUE;
 
 	if (buffer == NULL)
diff --git a/src/add-ons/accelerants/ati/rage128_overlay.cpp b/src/add-ons/accelerants/ati/rage128_overlay.cpp
index 727fa961fb..d59f50cf11 100644
--- a/src/add-ons/accelerants/ati/rage128_overlay.cpp
+++ b/src/add-ons/accelerants/ati/rage128_overlay.cpp
@@ -131,7 +131,7 @@ Rage128_DisplayOverlay(const overlay_window* window,
 	int32 p1_v_accum_init = ((tmp << 4) & 0x03ff8000) | 0x00000001;
 
 	// Compute offset of overlay buffer in the video memory.
-	uint32 offset = uint32(buffer->buffer) - si.videoMemAddr;
+	uint32 offset = (uint32)((addr_t)buffer->buffer - si.videoMemAddr);
 
 	OUTREG(R128_OV0_REG_LOAD_CNTL, 1);
 	while (!(INREG(R128_OV0_REG_LOAD_CNTL) & (1 << 3)))
-- 
2.30.2

