From 01fc004912c3ef6274cda7b0e3dee25c9327112e Mon Sep 17 00:00:00 2001
From: X512 <danger_mail@list.ru>
Date: Mon, 26 Jul 2021 03:16:56 +0900
Subject: AutoDeleter: add VMAddressSpacePutter, DeviceNodePutter (2)

Change-Id: Ia1344d952f7f40dafdbbb5c80a720d3ccb9fa4aa
---
 headers/private/shared/AutoDeleterDrivers.h | 13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

diff --git a/headers/private/shared/AutoDeleterDrivers.h b/headers/private/shared/AutoDeleterDrivers.h
index 0d4b98b564..eb9835ad90 100644
--- a/headers/private/shared/AutoDeleterDrivers.h
+++ b/headers/private/shared/AutoDeleterDrivers.h
@@ -32,6 +32,17 @@ typedef MethodDeleter<VMAddressSpace, void, &VMAddressSpace::Put> VMAddressSpace
 template <device_manager_info **deviceManager>
 using DeviceNodePutter = FieldFunctionDeleter<device_node, device_manager_info, deviceManager, void, &device_manager_info::put_node>;
 
+#else
+
+template <device_manager_info **deviceManager>
+struct DeviceNodePutter : FieldFunctionDeleter<device_node, device_manager_info, deviceManager, void, &device_manager_info::put_node>
+{
+	typedef FieldFunctionDeleter<device_node, device_manager_info, deviceManager, void, &device_manager_info::put_node> Base;
+
+	DeviceNodePutter() : Base() {}
+	DeviceNodePutter(device_node* object) : Base(object) {}
+};
+
 #endif
 
 #endif
@@ -47,9 +58,7 @@ using ::BPrivate::DriverSettingsUnloader;
 using ::BPrivate::VnodePutter;
 using ::BPrivate::DescriptorPutter;
 using ::BPrivate::VMAddressSpacePutter;
-#if __GNUC__ >= 4
 using ::BPrivate::DeviceNodePutter;
-#endif
 
 #endif
 
-- 
2.30.2

